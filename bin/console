#!/usr/bin/env ruby
# frozen_string_literal: true

require "bundler/setup"
require "payments"
require "irb"

# Optional preload for experimentation
Payments.configure(:mpesa, Payments::Configs::Mpesa) do |config|
  config[:key] = "test_key"
  config[:secret] = "test_secret"
  config[:shortcode] = "600999"
  config[:passkey] = "passkey_here"
  config[:sandbox] = true
  config[:extras] = {callback_url: "https://yourapp.com/callback"}
end

# Optional: define a custom console context (like Rails console helpers)
module ConsoleContext
  def mpesa
    Payments[:mpesa]
  end

  def stk_push(phone:, amount:, reference:)
    Payments::Mpesa::StkPush.call(phone_number: phone, amount:, reference:)
  end
end

IRB.setup(nil)
workspace = IRB::WorkSpace.new(ConsoleContext)
IRB.conf[:MAIN_CONTEXT] = IRB::Context.new(IRB::Irb.new(nil, workspace), workspace)

IRB.start
